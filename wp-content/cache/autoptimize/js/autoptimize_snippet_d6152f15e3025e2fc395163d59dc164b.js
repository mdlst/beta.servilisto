var $jDOPBSP=jQuery.noConflict();(function($,Views,Models,Collections){$(document).ready(function(){$('.not_is_tablet #main-single .list-option-left').pin({containerSelector:"#main-single",padding:{top:100,bottom:120}});Collections.Events=Backbone.Collection.extend({model:AE.Models.Event,action:'ae-fetch-events',initialize:function(){this.paged=1;}});EventItem=Views.PostItem.extend({template:_.template($('#de-event-item').html()),className:'event-wrapper event-item',onItemRendered:function(){}});ListEvent=Views.ListPost.extend({tagName:'div',itemView:EventItem,itemClass:'event-item'});if($('#block-events .postdata').length>0){var postdata=JSON.parse($('#block-events').find('.postdata').html()),collection=new Collections.Events(postdata);new ListEvent({el:$('#list-events'),collection:collection});}});Views.SinglePost=Backbone.Marionette.View.extend({el:'body.page-template-page-post-place-php',events:{'click a.place-action':'acting',},initialize:function(options){var view=this;_.bindAll(this,'updateUrl');this.options=_.extend(options,this.options);$('.tooltip-style').tooltip();if($('#next_id').length>0){var next=JSON.parse($('#next_id').html());this.next_post=next.id;this.load='next';}
if($('#prev_id').length>0){var prev=JSON.parse($('#prev_id').html());this.prev_post=prev.id;}
view.blockUi=new Views.BlockUi();view.collection=new Collections.Posts();view.collection.add(view.model);$('.popup-video').magnificPopup({type:'iframe'});},acting:function(e){var target=$(e.currentTarget),action=target.attr('data-action'),id=target.parents('.single-place-wrapper').attr('data-id'),model=this.collection.get(id),view=this;switch(action){case'edit_calender':AE.pubsub.trigger('ae:model:onCreateCalender',model);var id=$jDOPBSP('#DOPBSP-calendar-ID').val();DOPBSPBackEnd.toggleMessages('active',DOPBSPBackEnd.text('MESSAGES_LOADING'));DOPBSPBackEndSettings.toggle(id,'calendar');$.post(ajaxurl,{action:'dopbsp_calendar_get_options',id:id},function(data){$('#DOPBSP-column2 .dopbsp-column-content').html('<div id="DOPBSP-calendar"></div>');$('#DOPBSP-calendar').DOPBSPCalendarBackEnd($.parseJSON(data));$.post(ajaxurl,{action:'dopbsp_get_new_reservations',id:id},function(data){if(parseInt(data)!==0){$('#DOPBSP-new-reservations').addClass('dopbsp-new');$('#DOPBSP-new-reservations span').html(data);}});}).fail(function(data){DOPBSPBackEnd.toggleMessages('error',data.status+': '+data.statusText);});break;case'edit':AE.pubsub.trigger('ae:model:onEdit',model);break;case'reject':AE.pubsub.trigger('ae:model:onReject',model);break;case'archive':if(confirm(ae_globals.confirm_message)){model.save('post_status','archive',{beforeSend:function(){},success:function(result,status){if(status.success){AE.pubsub.trigger('ae:notification',{msg:status.msg,notice_type:'success',});window.location.reload();}else{AE.pubsub.trigger('ae:notification',{msg:status.msg,notice_type:'error',});}}});}
break;case'toggleFeature':if(parseInt(model.get('et_featured'))==1){model.set('et_featured',0);}else{model.set('et_featured',1);}
model.save('','',{beforeSend:function(){},success:function(result,status){if(status.success){AE.pubsub.trigger('ae:notification',{msg:status.msg,notice_type:'success',});window.location.reload();}else{AE.pubsub.trigger('ae:notification',{msg:status.msg,notice_type:'error',});}}});break;case'approve':model.save('publish','1',{beforeSend:function(){},success:function(result,status){if(status.success){window.location.href=model.get('permalink');}}});break;default:break;}},slideToReview:function(event){event.preventDefault();var target_offset=$("#review").offset();var target_top=target_offset.top;$('html, body').animate({scrollTop:target_top-200},500,'easeOutExpo');},jumbToReview:function(event){event.preventDefault();var target_offset=$("#review-list").offset();var target_top=target_offset.top;$('html, body').animate({scrollTop:target_top-200},500,'easeOutExpo');},favorite:function(event){event.preventDefault();var $target=$(event.currentTarget),view=this,favorite=new Models.Favorite({comment_post_ID:$target.attr('data-id'),sync:'add'});favorite.save('sync','add',{beforeSend:function(){view.blockUi.block($target);},success:function(result,res,xhr){$target.closest('li').attr('data-original-title',res.text);$target.addClass('loved').removeClass('favorite');$target.attr('data-favorite-id',res.data);view.blockUi.unblock();}});},removeFavorite:function(event){event.preventDefault();var $target=$(event.currentTarget),view=this,favorite=new Models.Favorite({id:$target.attr('data-favorite-id'),ID:$target.attr('data-favorite-id'),sync:'remove'});favorite.save('sync','remove',{beforeSend:function(){view.blockUi.block($target);},success:function(result,res,xhr){$target.closest('li').attr('data-original-title',res.text);$target.addClass('favorite').removeClass('loved');view.blockUi.unblock();}});},editPostSucess:function(model){console.log('a');if(res.success){window.location.reload();}},loadNextPost:function(event){event.preventDefault();var model=this.next_post,$target=$(event.currentTarget),view=this;if(!model){model=this.prev_post;this.load='prev';}
$.ajax({url:ae_globals.ajaxURL,type:'get',data:{action:'de-next-place',id:model,current:view.model.get('id'),load:view.load},beforeSend:function(){view.blockUi.block($target);},success:function(res){view.blockUi.unblock();if(res.success){$('#single-more-place').append(res.content);$('#single-place-'+res.post_id).find('.fancybox').magnificPopup({type:'image',gallery:{enabled:true},});$('.not_is_tablet #single-place-'+res.post_id).find(".list-option-left").pin({containerSelector:'#single-place-'+res.post_id,padding:{top:100,bottom:120}});if(view.load=='next'){view.next_post=res.next;}
if(view.load=='prev'){view.prev_post=res.prev;}
var model=new Models.Post({id:res.post_id,ID:res.post_id,pageTitle:res.pageTitle,link:res.link});document.title=res.pageTitle;window.history.pushState({"html":res.content,"pageTitle":res.pageTitle},"",res.link);view.collection.add(model);view.bindInview();model.fetch();$('.rate-it').raty({readOnly:true,half:true,score:function(){return $(this).attr('data-score');},hints:raty.hint});}else{$target.remove();}}});},bindInview:function(){var view=this;this.$('.single-place-wrapper').bind('inview',view.updateUrl);},updateUrl:function(event,isVisible){var view=this;if(!isVisible){this.inViewVisible=false;return;}
var $target=$(event.currentTarget),id=$target.attr('data-id'),model=this.collection.get(parseInt(id));document.title=model.get('pageTitle');window.history.pushState({"html":$target.html(),"pageTitle":model.get('pageTitle')},"",model.get('link'));}});Models.Favorite=Backbone.Model.extend({action:'ae-sync-favorite',initialize:function(){}});})(jQuery,AE.Views,AE.Models,AE.Collections);function dopbspGetUrlVars(){var vars={};var parts=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){vars[key]=value;});return vars;};