(function($,Views,Models,AE){AE.pubsub=AE.pubsub||{};_.extend(AE.pubsub,Backbone.Events);var pubsub=pubsub||AE.pubsub;Views.Comment=Backbone.View.extend({el:'body',events:{'click .rating_submit':'check_review_data','change #de_multirating':'de_multirating','change #place_category':'change_category'},initialize:function(options){this.blockUi=new Views.BlockUi();var view=this;AE.pubsub.on('ae:notification',this.showNotice,this);this.noti_templates=new _.template('<div class="notification autohide {{= type }}-bg">'+'<div class="main-center">'+'{{= msg }}'+'</div>'+'</div>');AE.pubsub.on('AE:afterSetupFields',this.setupcritical,this);},setupcritical:function(model){var tax=model.get('tax_input'),de_critical_cate=model.get('de_critical_cate'),place_category=tax['place_category'];$('#critical_cate').html('');if(place_category==null)return false;$.each(place_category,function(key,value){if(value.term_id==de_critical_cate){;$('#critical_cate').append('<option value="'+value.term_id+'" selected>'+value.name+'</option>');}else{$('#critical_cate').append('<option value="'+value.term_id+'">'+value.name+'</option>');}});},check_review_data:function(event){var view=this;var flag_star=true;$('.multi-rating-it').each(function(){var name=$(this).attr('data-score-name');if($(this).find('input[type="hidden"]').val()==''&&flag_star==true){AE.pubsub.trigger('ae:notification',{msg:de_multirating_globals.invalid_rating,notice_type:'error'});flag_star=false;}});if(!flag_star)return false;var comment_content=$('.multi-rating-comment-form').find('textarea#de_multirating_comment').val();if(comment_content==''){AE.pubsub.trigger('ae:notification',{msg:de_multirating_globals.invalid_content,notice_type:'error'});return false;}this.blockUi.block($('.multi-rating-comment-form'));$('.multi-rating-comment-form').submit();},showNotice:function(params){var view=this;$('div.notification').remove();var notification=$(view.noti_templates({msg:params.msg,type:params.notice_type}));if($('#wpadminbar').length!==0){notification.addClass('having-adminbar');}notification.hide().prependTo('body').fadeIn('fast').delay(1000).fadeOut(5000,function(){$(this).remove();});},de_multirating:function(event){event.preventDefault();if($("#de_multirating").checked==false){$('#de_multirating_use').val(0);$('.select_review_criteria_container').hide();}else{$('#de_multirating_use').val(1);$('.select_review_criteria_container').fadeIn();}},change_category:function(event){$('#critical_cate').html('');var taget=$(event.currentTarget),val=taget.val(),items=$("#place_category option:selected").map(function(){return $(this).text();}).get();if(val==null)return false;$.each(val,function(index,value){$('#critical_cate').append('<option value='+value+'>'+items[index]+'</option>');});}});$(document).ready(function(){$('.multi-rating-it').each(function(){$(this).raty({half:true,scoreName:$(this).attr('data-score-name'),hints:raty.hint});});$('.multi-rate-it').raty({readOnly:true,half:true,score:function(){return $(this).attr('data-score');},hints:raty.hint});$('.review_criteria_use').chosen({width:'95%',max_selected_options:parseInt(de_multirating_globals.max_review_criterias),inherit_select_classes:false});new Views.Comment();});})(jQuery,AE.Views,AE.Models,window.AE);